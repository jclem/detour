<% if flash.notice %>
  <div class="alert alert-success"><%= flash.notice %></div>
<% end %>

<% if flash.alert %>
  <div class="alert alert-danger"><%= flash.alert %></div>
<% end %>

<h1><%= params[:flaggable_type].classify %> Flags</h1>

<% if @flag_form.errors? %>
  <div class="panel panel-danger">
    <div class="panel-heading">Whoops! There were some errors saving your flags:</div>

    <div class="panel-body">
      <ul>
        <% @flag_form.features.each do |feature| %>
          <% feature.errors.full_messages.each do |msg| %>
              <li><strong><%= feature.name %>:</strong> <%= msg %></li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>
<% end %>

<%= form_tag do %>
  <%= table do %>
    <thead>
      <tr>
        <th></th>
        <th>Feature</th>

        <%= render partial: "detour/shared/spacer_cells", locals: { tag: "th" } %>

        <% @flag_form.group_names.each do |group_name| %>
          <th>
            <span class="group-header">
              <%= group_name %>
            </span>
          </th>
        <% end %>

        <th class="percentage-header">Percentage</th>
        <th class="counter-header">Flag-ins</th>
        <th class="counter-header">Opt-outs</th>
      </tr>
    </thead>

    <tbody>
      <%= render partial: "feature_form", collection: @flag_form.features, as: :feature %>
    </tbody>
  <% end %>

  <%= content_tag :span, "Create a Feature", class: "btn btn-default pull-left", data: { toggle: "modal", target: "#create-feature" } %>

  <div class="btn-group pull-right">
    <% if @flag_form.errors? %>
      <%= link_to "Cancel", request.path, class: "btn btn-default" %>
    <% end %>

    <%= submit_tag "Save Changes", class: "btn btn-primary" %>
  </div>
<% end %>

<div class="modal" id="delete-feature" tabindex="-1" role="dialog" aria-labelledby="delete-feature-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="create-feature-modal-label">Delete Feature</h4>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete <span class="feature-name"></span>?</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <%= link_to "Delete Feature", "javascript:void(0)", method: :delete, class: "btn btn-danger" %>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="create-feature" tabindex="-1" role="dialog" aria-labelledby="create-feature-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="create-feature-modal-label">Create a Feature</h4>
      </div>

      <%= form_for Detour::Feature.new, remote: true do |form| %>
        <div class="modal-body">
          <%= form.text_field :name, class: "form-control", placeholder: "feature_name" %>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <%= form.submit "Create Feature", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
